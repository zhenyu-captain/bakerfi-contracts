## 基础说明
### Slither → Mythril 的数据流
slither_analysis/
│
├── detectors/full-scan.json     
│   └─→ 【核心依赖】Mythril 读取这个来决定"分析哪些合约"
│       模式 5: 提取高危合约列表 → 只分析这 4 个合约
│       节省时间: 4/221 = 只需 1.8% 的分析时间
│
├── abi/*.json                   
│   └─→ 【辅助信息】在报告中显示统计数据
│       "该项目有 30 个合约"
│
├── contract-summary/*.txt       
│   └─→ 【辅助信息】显示合约总数
│       "共 221 个合约被 Slither 分析"
│
├── ast/*.json                   
│   └─→ 【不直接使用】Mythril 有自己的 AST 解析
│
└── slithir/*.txt                
    └─→ 【不直接使用】Mythril 有自己的符号执行引擎

## 工具分工
Slither (静态分析)
  ├─ 快速扫描所有合约
  ├─ 发现可疑模式
  └─ 输出: "这 4 个合约有高危问题"

Mythril (符号执行)
  ├─ 读取 Slither 结果
  ├─ 只分析这 4 个合约
  └─ 深度验证漏洞

## 贴近专业审计标准流程：
Code4rena / Trail of Bits / OpenZeppelin 审计流程:

第一步: Slither 全面扫描 (5分钟)
  ↓ detectors.json
第二步: 根据结果选择目标
  ↓
第三步: Mythril/Manticore 深度分析 (数小时)


## 分析范围1

| 层级 | 模式 | 分析范围 | 来源 | 是否全覆盖 | 特点 | 典型用途 |
|------|------|-----------|--------|--------------|-----------|------------|
| **L1（最宽）** | 🥇 **快速扫描**<br>`--execution-timeout 300` | **所有核心合约**（来自 Slither ABI/AST 全集） | Slither 全量输出 | ✅ 是 | 时间最短、结果粗略 | CI/CD 预检查、快速粗筛 |
| **L2** | 🥈 **标准扫描**<br>`--execution-timeout 900` | **所有核心合约**（同上） | Slither 全量输出 | ✅ 是 | 深度适中、路径较全 | 正式审计阶段主力模式 |
| **L3** | 🥉 **高危自动分析** | **仅高危合约**（从 Slither `detectors.json` 自动提取） | Slither 高危检测结果 | ⚠️ 部分覆盖 | 智能聚焦、效率高 | 默认推荐模式（高危优先） |
| **L4** | 🧬 **深度扫描**<br>`--execution-timeout 3600` | **特定合约**（手动指定，如 Vault / Strategy） | 审计员选择 | ❌ 否 | 穷举执行路径、生成 POC | 高价值模块验证与漏洞重现 |
| **L5（最窄）** | 🧱 **单合约分析** | **单一合约**（手动输入路径） | 用户输入 | ❌ 否 | 手动复现、报告生成 | 教学、报告编制、漏洞验证 |

## 分析范围2

| 模式编号 | 模式名称 | 脚本行为 | 目标合约范围 | 说明 |
|-----------|-----------|------------|----------------|------|
| **①** | **快速扫描** | 批量分析核心合约（`Vault.sol`, `VaultBase.sol`, `StrategyLeverage.sol`） | 全量（核心集） | ✅ 全项目快速覆盖（300 秒超时），用于快速粗筛或 CI 预检 |
| **②** | **标准扫描** | 与快速扫描相同，但延长执行时间（900 秒） | 全量（核心集） | ✅ 审计主力模式，平衡性能与深度，生成主 JSON 报告 |
| **③** | **深度扫描** | **仅针对单个合约执行，超时 3600 秒** | 🧩 单个目标合约（手动指定） | ✅ 用于穷举执行路径、生成漏洞 POC，面向复杂逻辑验证 |
| **④** | **单合约分析** | 用户手动指定合约路径，生成 **JSON + Markdown 报告** | 单一文件 | ✅ 教学或报告模式，用于复现与验证特定漏洞 |
| **⑤** | **高危自动分析** | 自动读取 Slither 检测结果，提取高危（High）合约并批量分析 | Slither 标记为 High 的合约 | ✅ 智能聚焦模式，自动定位潜在高风险合约（推荐默认） |


## 用途

| 顺序 | 模式 | 推荐用途 | 执行逻辑 | 说明 |
|------|------|-----------|-----------|------|
| 🥇 **⑤ 高危自动分析** | 初步聚焦阶段 | 从 Slither 检测结果中提取高危（High）合约，先行符号执行 | 快速锁定潜在漏洞密集区，生成首轮结果样本 |
| 🥈 **② 标准扫描** | 主体审计阶段 | 对所有核心合约执行中等深度符号执行（900 秒超时） | 全面覆盖、生成标准 JSON 报告，用于人工分析 |
| 🥉 **③ 深度扫描** | 验证与漏洞复现 | 针对高复杂度或资金相关模块（如 `Vault`、`Strategy`）执行穷举路径分析 | 生成 POC 级别路径与攻击场景 |
| 🧩 **④ 单合约分析** | 报告与教学阶段 | 对指定合约执行（手动输入路径），输出 Markdown + JSON | 验证特定问题、生成独立报告或教学样例 |
| ⚙️ **（① 快速扫描）** | *可选*（CI/CD 用） | 对全体合约执行轻量符号执行（300 秒超时） | 非人工审计阶段使用，可略过 |

---

### 推荐顺序

> **⑤ 高危自动分析 → ② 标准扫描 → ③ 深度扫描 → ④ 单合约分析**

---

### 阶段目的

| 阶段 | 目标 | 分析范围 | 输出 |
|------|------|-----------|------|
| **高危自动分析** | 快速聚焦风险热点 | Slither 标记为 High 的合约 | 初步符号执行报告（JSON） |
| **标准扫描** | 全面覆盖主力分析 | 所有核心合约（Vault / Strategy / Router 等） | 主报告（JSON + Markdown） |
| **深度扫描** | 深层验证与路径挖掘 | 关键模块或可疑点 | POC 路径 / 触发条件分析 |
| **单合约分析** | 报告与教学验证 | 单一指定合约 | 教学样例 / 人工复现报告 |

---

### 总结说明

> - 对 BakerFi 类项目（多模块、已过静态分析阶段）：
>   - 保留 **⑤ → ② → ③ → ④** 四步最优顺序。  
>   - 跳过快速扫描（①），除非要做持续集成或每日安全巡检。  
>   - 这样执行路径更贴近 **专业审计机构 / Code4rena 参赛者工作流**。

---




