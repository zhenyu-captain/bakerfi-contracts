# ğŸ§­ BakerFi PoC å­¦ä¹ ä¸å¤ç°é¡ºåºæ€»è¡¨ï¼ˆæ¨èè·¯å¾„ï¼‰

æœ¬è·¯çº¿æ—¨åœ¨å¸®åŠ©ä½ ä»¥ **ç”±æµ…å…¥æ·±ã€ç”±æ ¸å¿ƒåˆ°å¤–å›´** çš„é¡ºåºç†è§£å¹¶å¤ç° BakerFi é¡¹ç›®ä¸­çš„æ‰€æœ‰å®‰å…¨ç›¸å…³æµ‹è¯•ï¼ˆPoCï¼‰ã€‚  
é€šè¿‡å¾ªåºæ¸è¿›çš„å­¦ä¹ ï¼Œä½ å°†é€æ­¥æŒæ¡æ™ºèƒ½åˆçº¦ç³»ç»Ÿçš„èµ„é‡‘æµã€å®‰å…¨è¾¹ç•Œä¸æ”»å‡»è·¯å¾„ã€‚

---

## ğŸ§± é˜¶æ®µå­¦ä¹ é¡ºåºæ€»è§ˆ

| é˜¶æ®µ | æ¨¡å—ç±»å‹ | æµ‹è¯•æ–‡ä»¶ / å‘½ä»¤ | å­¦ä¹ é‡ç‚¹ | å¤‡æ³¨ |
|------|-----------|------------------|------------|--------|
| **â‘  æ ¸å¿ƒé‡‘åº“é€»è¾‘ï¼ˆåŸºç¡€ï¼‰** | Vault åŸºç¡€æ¨¡å— | `npx hardhat test test/core/vault/Vault.ts` | ğŸ”¹ç†è§£ Vault å­˜å–æ¬¾æ ¸å¿ƒé€»è¾‘ï¼ˆdeposit / withdrawï¼‰<br>ğŸ”¹æ–­è¨€å®‰å…¨ï¼šä½™é¢ã€æ€»èµ„äº§ã€ä¸€è‡´æ€§ | å»ºç«‹ç³»ç»Ÿèµ„é‡‘æµç†è§£ï¼›æ‰€æœ‰æ”»å‡»éƒ½ä»¥ Vault ä¸ºä¸­å¿ƒ |
| **â‘¡ æœåŠ¡æ³¨å†Œä¸ç³»ç»Ÿå¸¸é‡ï¼ˆè¾…åŠ©ï¼‰** | æ³¨å†Œä¸é…ç½® | `npx hardhat test test/core/vault/VaultRegistry.ts` | ğŸ”¹ç†è§£æœåŠ¡æ³¨å†Œæœºåˆ¶<br>ğŸ”¹é…ç½®å®‰å…¨ï¼šæ˜ å°„ã€è§£æã€ä¾èµ–æ³¨å…¥ | Vault åœ°å€è§£æçš„å®‰å…¨æ€§æ˜¯å‡çº§å’ŒRouterçš„å‰æ |
| **â‘¢ å¤–éƒ¨å›è°ƒä¸é‡å…¥æ”»å‡»æœºåˆ¶ï¼ˆå…³é”®ï¼‰** | Hook / Callback | `npx hardhat test test/hooks/UseTokenActions.test.ts` | ğŸ”¹ç ”ç©¶å›è°ƒè§¦å‘é¡ºåºï¼ˆonTransfer / onHookï¼‰<br>ğŸ”¹åˆ†æ ReentrancyGuard çš„å·¥ä½œæ–¹å¼ | âš ï¸ æœ€é‡è¦çš„å®‰å…¨èµ·ç‚¹ï¼šç†è§£å¯é‡å…¥ä¸æ”»å‡»çª—å£ |
| **â‘£ æˆæƒä¸ç­¾åæ”»å‡»é¢ï¼ˆPermitç±»ï¼‰** | ERC20Permit / æˆæƒæœºåˆ¶ | `npx hardhat test test/hooks/UsePermitTransfers.ts` | ğŸ”¹ç†è§£ ERC20Permit æˆæƒæ¨¡å‹<br>ğŸ”¹éªŒè¯ç­¾ååŸŸï¼ˆdomain separatorï¼‰å®‰å…¨ | å¸¸è§æˆæƒç»•è¿‡æ”»å‡»æ¨¡å¼ |
| **â‘¤ è·¯ç”±ä¸å‘½ä»¤è°ƒåº¦ï¼ˆç³»ç»Ÿæ€§æµ‹è¯•ï¼‰** | Router / Dispatcher | `npx hardhat test test/core/vault/VaultRouterDispatcher.ts`<br>`npx hardhat test test/core/vault/VaultRouter.ts` | ğŸ”¹å­¦ä¹ å‘½ä»¤ç¼–ç /è§£ç æœºåˆ¶<br>ğŸ”¹ç†è§£ Router â†’ Vault ä¹‹é—´çš„æ¡¥æ¥é€»è¾‘ | Vault èµ„é‡‘æµçš„çœŸæ­£å…¥å£ç‚¹ï¼ˆé€»è¾‘å±‚æ ¸å¿ƒï¼‰ |
| **â‘¥ å¤šç­–ç•¥ä¸å†å¹³è¡¡ä¸€è‡´æ€§ï¼ˆèµ„é‡‘æµé£é™©ï¼‰** | MultiStrategy | `npx hardhat test test/core/vault/VaultMultiStrategy.ts` | ğŸ”¹éªŒè¯å¤šç­–ç•¥èµ„é‡‘åˆ†é…ä¸€è‡´æ€§<br>ğŸ”¹å­¦ä¹ å¦‚ä½•åœ¨ç­–ç•¥å†å¹³è¡¡æ—¶ä¿æŒèµ„é‡‘å®‰å…¨ | é«˜é¢‘å‡ºé”™åŒºï¼Œæ¶‰åŠèµ„é‡‘èšåˆä¸åˆ†é… |
| **â‘¦ é—ªç”µè´·æ‰§è¡Œè·¯å¾„ä¸å›æµå®‰å…¨ï¼ˆå¤åˆæ”»å‡»ï¼‰** | FlashLoan | `npx hardhat test test/core/BalancerFlashLoan.ts` | ğŸ”¹åˆ†æâ€œå€Ÿ â†’ ç”¨ â†’ è¿˜â€ä¸‰æ­¥é€»è¾‘<br>ğŸ”¹ç†è§£å¦‚ä½•éªŒè¯é—ªç”µè´·åœ¨åŒä¸€äº¤æ˜“å†…å›æµ<br>ğŸ”¹å­¦ä¹ å¸¸è§é—ªç”µè´·æ”»å‡»æ‰‹æ³• | âš ï¸ é«˜å¤æ‚åº¦ï¼›å»ºè®®åœ¨æŒæ¡ Vault å’Œ Router åè¿›è¡Œ |
| **â‘§ é¢„è¨€æœºæ“çºµä¸ç²¾åº¦æ ¡éªŒï¼ˆç¯å¢ƒæ”»å‡»ï¼‰** | Oracles | `npx hardhat test test/oracles/ExRateOracle.ts`<br>`npx hardhat test test/oracles/CustomExRateOracle.ts`<br>`npx hardhat test test/pyth/PythOracle.ts`<br>`npx hardhat test test/oracles/ChainLinkOracles.ts` | ğŸ”¹ç†è§£å–‚ä»·ä¸ç”¨ä»·åˆ†ç¦»æ¨¡å‹<br>ğŸ”¹éªŒè¯å°æ•°ä½è§„èŒƒåŒ–ä¸è¿‡æœŸä»·æ ¼ï¼ˆstalenessï¼‰<br>ğŸ”¹å­¦ä¹ é¢„è¨€æœºæ“çºµæ”»å‡»åŸç† | å»ºç«‹â€œç¯å¢ƒè¾“å…¥å®‰å…¨â€çš„ç†è§£ï¼Œè¿æ¥ç°å®ä¸–ç•Œæ”»å‡»é¢ |
| **â‘¨ å‡çº§ä¸ä»£ç†å®‰å…¨ï¼ˆç³»ç»Ÿç”Ÿå‘½å‘¨æœŸï¼‰** | Proxy / Upgrade | `npx hardhat test test/proxy/VaultProxy.ts`<br>`npx hardhat test test/core/vault/VaultUpgradeMilleFeuille.ts`<br>`npx hardhat test test/core/vault/VaultUpgradeMorphoBlue.ts` | ğŸ”¹å­¦ä¹  ProxyAdmin æƒé™æ¨¡å‹<br>ğŸ”¹éªŒè¯å­˜å‚¨å¸ƒå±€å…¼å®¹æ€§ï¼ˆslot gapï¼‰<br>ğŸ”¹ç†è§£å®ç°ä¸ä»£ç†åˆ†ç¦»çš„é£é™© | âš™ï¸ å»ºè®®ç»“åˆ Slither + Securify è¿›è¡ŒéªŒè¯ |
| **â‘© å¤–éƒ¨åè®®äº¤äº’ä¸Hook-Swapperå¤åˆï¼ˆæœ€é«˜çº§ï¼‰** | Swapper / Hooks | `npx hardhat test test/hooks/UseUnifiedSwapper.ts`<br>`npx hardhat test test/hooks/UseUniV2Swapper.test.ts`<br>`npx hardhat test test/hooks/UseAeroSwapper.ts`<br>`npx hardhat test test/hooks/UseCurveSwapper.ts`<br>`npx hardhat test test/hooks/UseWETH.test.ts`<br>`npx hardhat test test/hooks/UseIERC4626.test.ts` | ğŸ”¹å­¦ä¹ å¤–éƒ¨åˆçº¦äº¤äº’ï¼ˆDEX / Curve / ERC4626ï¼‰<br>ğŸ”¹ç†è§£å¤šåè®®ä¹‹é—´çš„ä¿¡ä»»è¾¹ç•Œ<br>ğŸ”¹è¯†åˆ«å¤–éƒ¨å›è°ƒä¸æ»‘ç‚¹æ”»å‡»è·¯å¾„ | ğŸ§© å±äºé›†å¤§æˆé˜¶æ®µï¼Œç»¼åˆæ€§æœ€å¼º |
| **â‘ª ç­–ç•¥å‚æ•°ä¸è¾¹ç•Œå®‰å…¨ï¼ˆé™„åŠ ï¼‰** | Strategies | `npx hardhat test test/core/strategies/StrategyLeverageSettings.ts` ç­‰ | ğŸ”¹ç†è§£ç­–ç•¥å‚æ•°å®‰å…¨ï¼ˆLTV / Slippage / Loopsï¼‰<br>ğŸ”¹æµ‹è¯•è¾¹ç•Œæ–­è¨€ä¸æç«¯è¾“å…¥ | è¡¥å……é˜¶æ®µï¼Œç”¨æ¥æå‡è¾¹ç•Œæµ‹è¯•èƒ½åŠ› |

---

## ğŸ§  å»ºè®®çš„ 6 å‘¨å¤ç°èŠ‚å¥

| å‘¨æ¬¡ | é‡ç‚¹æ¨¡å— | POC è·¯å¾„ | ç›®æ ‡ |
|------|------------|-----------|-----------|
| **ç¬¬ 1 å‘¨** | Vault åŸºç¡€ + Registry | `Vault.ts`, `VaultRegistry.ts` | å»ºç«‹ç³»ç»Ÿç»“æ„ç†è§£ï¼ŒæŒæ¡èµ„é‡‘æµã€‚ |
| **ç¬¬ 2 å‘¨** | Reentrancy + Permit | `UseTokenActions.test.ts`, `UsePermitTransfers.ts` | ç†è§£å®‰å…¨è¾¹ç•Œä¸æ”»å‡»çª—å£ã€‚ |
| **ç¬¬ 3 å‘¨** | Router + MultiStrategy | `VaultRouter.ts`, `VaultRouterDispatcher.ts`, `VaultMultiStrategy.ts` | ç†è§£è·¯ç”±é€»è¾‘ä¸å†å¹³è¡¡ä¸€è‡´æ€§ã€‚ |
| **ç¬¬ 4 å‘¨** | FlashLoan | `BalancerFlashLoan.ts` | ç†è§£åŸå­æ€§ä¸å¤šäº‹åŠ¡æ”»å‡»é¢ã€‚ |
| **ç¬¬ 5 å‘¨** | Oracle ç³»åˆ— | `ExRateOracle.ts`, `CustomExRateOracle.ts`, `PythOracle.ts`, `ChainLinkOracles.ts` | ç†è§£ä»·æ ¼æ“çºµä¸ç¯å¢ƒä¾èµ–é£é™©ã€‚ |
| **ç¬¬ 6 å‘¨** | Proxy + Swapper ç»¼åˆ | æ‰€æœ‰ Proxy ä¸ Swapper æµ‹è¯• | æŒæ¡å‡çº§ã€å¤åˆäº¤äº’ä¸å¤–éƒ¨åè®®é£é™©ã€‚ |

---

## âš™ï¸ æ¯ä¸ª PoC çš„å›ºå®šæ“ä½œæµç¨‹

1. **è¿è¡Œå¹¶è¯»æ‡‚æµ‹è¯•**
   ```bash
   npx hardhat test <file-path>






## ç›®å½•ç»“æ„
* audits è‡ªå®šä¹‰æ–‡ä»¶å¤¹ï¼Œè¿‡ç¨‹æ–‡ä»¶
* handbooks è‡ªå®šä¹‰æ–‡ä»¶å¤¹ï¼Œè¿‡ç¨‹æ–‡ä»¶
* src ç¼–è¯‘æ„å»ºäº§ç‰©ï¼Œä¸æ‰¿è½½æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
* contracts åˆçº¦æºç ï¼Œä¸šåŠ¡é€»è¾‘ç›®å½•
* ä¸‹ä¸€ä¸ªæ˜¯ doc ç›®å½•

---

### ğŸ§± `test` ç›®å½•è¯´æ˜
å­˜æ”¾ Hardhat æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ï¼ŒåŸºäº Mocha æˆ– Chai æ¡†æ¶ã€‚æ¯ä¸ªæµ‹è¯•æ–‡ä»¶å¯¹åº”ä¸€ä¸ªåˆçº¦æˆ–åˆçº¦åŠŸèƒ½æ¨¡å—ï¼Œæµ‹è¯•å…¶åœ¨ä¸åŒåœºæ™¯ä¸‹çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š`{åˆçº¦å}.test.ts`ï¼Œä¾‹å¦‚ `Vault.test.ts`ã€`Strategy.test.ts` ç­‰ã€‚

* core æ˜¯é’ˆå¯¹â€œåè®®æ ¸å¿ƒæ¨¡å—â€çš„è‡ªåŠ¨åŒ–æµ‹è¯•é›†åˆï¼ŒéªŒè¯åº“å‡½æ•°ã€ç­–ç•¥æµç¨‹ã€Vault è¡Œä¸ºã€Router æ‰¹å¤„ç†ã€ä»¥åŠé—ªç”µè´·ä¸å‡çº§å…¼å®¹ç­‰å…³é”®è·¯å¾„ã€‚- å®ƒä»¬éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§ã€æµç¨‹ä¸è¾¹ç•Œï¼ˆå«å›æ»šã€æƒé™ã€å‡çº§å…¼å®¹ï¼‰ï¼Œä¸»è¦æ˜¯â€œåŠŸèƒ½é¢„æœŸâ€æµ‹è¯•ï¼šå•å…ƒä¸é›†æˆï¼ŒéªŒè¯æŒ‰è®¾è®¡å·¥ä½œã€‚ä½†ä¸ç­‰åŒäºç³»ç»ŸåŒ–çš„å®‰å…¨å®¡è®¡ä¸æ¨¡ç³Šæµ‹è¯•ã€‚
* hooks æ˜¯â€œé’©å­ä¸äº¤æ¢å™¨â€ç›¸å…³çš„åŠŸèƒ½/é›†æˆæµ‹è¯•é›†åˆï¼ŒéªŒè¯ä»£å¸äº¤æ¢ã€Wrap/Unwrapã€ERC4626 äº¤äº’ã€Permit æˆæƒã€ä»¥åŠç»Ÿä¸€è·¯ç”±ä¸‹çš„ç»„åˆæ“ä½œä¸å›æ»šã€‚å±äºâ€œåŠŸèƒ½é¢„æœŸæµ‹è¯•â€ï¼Œä»¥é›†æˆæµ‹è¯•ä¸ºä¸»ã€‚ ä¸æ˜¯ä¸“é—¨çš„å®‰å…¨æµ‹è¯•å¥—ä»¶ï¼›ä¹Ÿä¸ä»¥çº¯å•å…ƒæµ‹è¯•ä¸ºä¸»ã€‚
* libraries ç”¨æ¥æµ‹è¯•åˆçº¦â€œåº“ï¼ˆlibrariesï¼‰â€çš„çº¯å‡½æ•°æ­£ç¡®æ€§ä¸è¾¹ç•Œè¡Œä¸ºã€‚ å…³æ³¨æ•°å€¼è®¡ç®—çš„å¯é æ€§ï¼šç²¾åº¦ã€èˆå…¥æ–¹å‘ã€æº¢å‡º/ä¸‹æº¢é˜²æŠ¤ã€æç«¯è¾“å…¥ç­‰ã€‚è¿™æ˜¯â€œå•å…ƒæµ‹è¯•â€è€Œéå®‰å…¨æµ‹è¯•ï¼›ç›®æ ‡æ˜¯å‡½æ•°çº§æ­£ç¡®æ€§ä¸å¯é¢„æœŸè¡Œä¸ºã€‚ä¼šåŒ…å«è‹¥å¹²å¼‚å¸¸è·¯å¾„æ–­è¨€ï¼ˆå¦‚ revert ï¼‰ï¼Œä½†ä¸ç­‰åŒç³»ç»ŸåŒ–å®‰å…¨å®¡è®¡ã€‚
* oracles æ˜¯å¯¹åè®®é‡Œâ€œä»·æ ¼é¢„è¨€æœºâ€æ¨¡å—çš„åŠŸèƒ½/é›†æˆæµ‹è¯•é›†åˆã€‚ç›®æ ‡æ˜¯éªŒè¯æŠ¥ä»·æ­£ç¡®æ€§ã€ç²¾åº¦ä¸å°æ•°è§„èŒƒåŒ–ã€æ•°æ®æ–°é²œåº¦ï¼ˆstalenessï¼‰ã€å¼‚å¸¸ä¸å›é€€è·¯å¾„ï¼Œä»¥åŠæƒé™ä¸é…ç½®æ›´æ–°æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚
* proxy æ˜¯â€œå¯å‡çº§ä»£ç†ï¼ˆProxyï¼‰â€ç›¸å…³çš„åŠŸèƒ½/é›†æˆæµ‹è¯•é›†åˆã€‚ - ç›®æ ‡æ˜¯éªŒè¯ä»£ç†çš„éƒ¨ç½²ã€åˆå§‹åŒ–ã€å‡çº§æµç¨‹ã€æƒé™æ§åˆ¶ä¸å­˜å‚¨å¸ƒå±€å…¼å®¹æ€§æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚
* pyth æ˜¯é’ˆå¯¹ Pyth é¢„è¨€æœºçš„åŠŸèƒ½/é›†æˆæµ‹è¯•ç›®å½•ã€‚ç›®æ ‡æ˜¯éªŒè¯ä» Pyth å–‚ä»·è¯»å–ä¸è§„èŒƒåŒ–ã€æ•°æ®æ–°é²œåº¦ï¼ˆ publishTime ï¼‰ã€ç½®ä¿¡åŒºé—´ä¸å¼‚å¸¸è·¯å¾„çš„å¤„ç†æ˜¯å¦ç¬¦åˆè®¾è®¡ã€‚
* common.ts æ˜¯æµ‹è¯•ç”¨çš„å…±äº«å·¥å…·ä¸å¸¸é‡ï¼Œä¾›å„æµ‹è¯•æ–‡ä»¶ç»Ÿä¸€å¼•ç”¨ã€‚ ä¸»è¦ç”¨äºæ¡ä»¶åŒ–æ‰§è¡Œæµ‹è¯•ã€ä»¥åŠä¸ VaultRouter äº¤äº’æ—¶çš„å‘½ä»¤å¸¸é‡å’Œç®€åŒ–ç‰ˆ ABIã€‚



### ğŸ§± `poc` è¯´æ˜
* é’©å­ä¸Swapper
    - npx hardhat test test/hooks/UseUnifiedSwapper.ts
    - npx hardhat test test/hooks/UseUniV2Swapper.test.ts
    - npx hardhat test test/hooks/UseAeroSwapper.ts
    - npx hardhat test test/hooks/UseCurveSwapper.ts
    - npx hardhat test test/hooks/UseWETH.test.ts
    - npx hardhat test test/hooks/UseIERC4626.test.ts
* è·¯ç”±/æ ¸å¿ƒ
    - npx hardhat test test/core/vault/VaultLeverage.ts
    - npx hardhat test test/core/vault/VaultRouter.ts ï¼ˆå·²åˆ—ï¼‰
* é¢„è¨€æœº
    - npx hardhat test test/oracles/ExRateOracle.ts ï¼ˆå·²åˆ—ï¼‰
    - npx hardhat test test/oracles/ChainLinkOracles.ts
    - npx hardhat test test/pyth/PythOracle.ts ï¼ˆå·²åˆ—ï¼‰
* é—ªç”µè´·
    - npx hardhat test test/core/BalancerFlashLoan.ts ï¼ˆå·²åˆ—ï¼‰
* ä»£ç†/å‡çº§
    - npx hardhat test test/proxy/VaultProxy.ts ï¼ˆå·²åˆ—ï¼‰
    - npx hardhat test test/proxy/StrategyProxy.ts
* å…¶ä»–
    - test/hooks/UseTokenActions.test.ts ï¼šæ¶µç›–å¤–éƒ¨å›è°ƒ/é‡å…¥ç›¸å…³ PoCï¼ˆä¸ BorrowerAttacker.sol å…³è”ï¼‰ã€‚
    - test/hooks/UsePermitTransfers.ts ï¼šERC20Permit æ‹‰å–æˆæƒ PoCã€‚
    - test/hooks/Leverage.ts ï¼šæ æ†æµç¨‹åœ¨ hooks ä¾§çš„è¡¥å……æµ‹è¯•ã€‚
    - test/core/vault/VaultRouterDispatcher.ts ï¼šè·¯ç”±å‘½ä»¤åˆ†å‘ä¸ç¼–ç /è§£ç çš„ PoCã€‚
    - test/core/vault/VaultMultiStrategy.ts ï¼šå¤šç­–ç•¥åˆ†é…/å†å¹³è¡¡ä¸€è‡´æ€§ç›¸å…³æµ‹è¯•ã€‚
    - test/core/vault/Vault.ts ï¼šVault æ ¸å¿ƒå•å…ƒæµ‹è¯•ï¼ˆå¹¶éç‰¹å®š PoCï¼Œä½†åŒ…å«å…³é”®å®‰å…¨æ–­è¨€ï¼‰ã€‚
    - test/core/vault/VaultRegistry.ts ï¼šæœåŠ¡æ³¨å†Œè¡¨çš„åŸºç¡€å®‰å…¨æ ¡éªŒ
    - test/oracles/CustomExRateOracle.ts ï¼šè‡ªå®šä¹‰æ±‡ç‡é¢„è¨€æœºå®ç°çš„ PoCï¼Œè¦†ç›–ä¸åŒæ±‡ç‡æºçš„å®‰å…¨æ€§ä¸æ¥å£ä¸€è‡´æ€§ã€‚
    - test/core/vault/VaultUpgradeMilleFeuille.ts ä¸ test/core/vault/VaultUpgradeMorphoBlue.ts ï¼šå‡çº§è·¯å¾„çš„é›†æˆ/å›å½’æµ‹è¯•ï¼Œå±äºâ€œä»£ç†/å‡çº§â€ç±» PoCï¼Œå½“å‰ä½ çš„å‡çº§åˆ—è¡¨ä»…åŒ…å« Proxy æµ‹è¯•ï¼ŒæœªåŒ…å«è¿™ä¸¤ä¸ªâ€œå‡çº§â€æµ‹è¯•ã€‚
    - test/core/strategies/* ï¼šå¦‚ StrategyLeverageSettings.ts , StrategyUniV3SwapPark.ts , StrategySupplyAAVEv3.ts ç­‰ï¼Œåç­–ç•¥å‚æ•°ä¸è¾¹ç•Œå®‰å…¨ï¼Œå±äºå®‰å…¨ç›¸å…³çš„å•æµ‹è€Œéå…¸å‹ PoCã€‚
    - test/core/libraries/* : Command.ts , Rebase.ts ï¼Œè¦†ç›–å‘½ä»¤ç¼–ç /è§£ç ä¸ rebase é€»è¾‘ï¼Œæ›´å¤šæ˜¯åº“çº§ä¿è¯è€Œéç›´æ¥ PoCã€‚
--- 

### ğŸ§± `constants` ç›®å½•è¯´æ˜ï¼ˆç±»æ¯” Web ä¸–ç•Œï¼‰
åœ¨ Web3 é¡¹ç›®ä¸­ï¼Œ`constants` ç›®å½•å°±åƒ **â€œåç«¯æœåŠ¡å™¨çš„é…ç½®ä¸­å¿ƒâ€**ã€‚  
æ¯ä¸ªæ–‡ä»¶éƒ½å¯¹åº”ç°å®ä¸–ç•Œé‡ŒæœåŠ¡å™¨è¿è¡Œæ‰€éœ€çš„ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼š  
æœ‰çš„ç®¡â€œIP åœ°å€è¡¨â€ï¼Œæœ‰çš„ç®¡â€œç¯å¢ƒå‚æ•°â€ï¼Œæœ‰çš„å®šä¹‰â€œæ¥å£è·¯å¾„â€æˆ–â€œé…ç½®æ–‡ä»¶æ ¼å¼â€ã€‚

---

| æ–‡ä»¶ | åŠŸèƒ½è¯´æ˜ | ğŸŒ Web ä¸–ç•Œç±»æ¯” | ğŸ§© åœ¨ç³»ç»Ÿä¸­çš„ä½œç”¨ |
|------|-----------|----------------|------------------|
| **contracts.ts** | å®šä¹‰ï¼šå¦‚æœæˆ‘åœ¨ X ç½‘ç»œè¿è¡Œè¿™ä¸ªç­–ç•¥ï¼Œç›¸å…³åˆçº¦éƒ½éƒ¨ç½²åœ¨å“ªä¸ªåœ°å€ã€‚<br>æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯æ¯ä¸ªç½‘ç»œä¸Šæ™ºèƒ½åˆçº¦çš„éƒ¨ç½²åœ°å€è¡¨ã€‚ | ğŸŒ **æœåŠ¡å™¨ IP åœ°å€è¡¨**ï¼ˆå‘Šè¯‰ç³»ç»ŸæœåŠ¡éƒ½éƒ¨ç½²åœ¨å“ªï¼‰ | å†³å®š **â€œåœ¨å“ªé‡Œè¿è¡Œâ€** |
| **network-deploy-config.ts** | å®šä¹‰ï¼šè¿è¡Œæ—¶è¦è¿æ¥å“ªæ¡é“¾ã€ä½¿ç”¨å“ªäº›ä¾èµ–åœ°å€ã€é‡‡ç”¨ä»€ä¹ˆè¿è¡Œå‚æ•°ï¼ˆå¦‚è·¯ç”±ã€å–‚ä»·ã€å€Ÿè´·å¸‚åœºç­‰ï¼‰ã€‚ | âš™ï¸ **æœåŠ¡å™¨è¿è¡Œå‚æ•°è¯´æ˜ä¹¦**ï¼ˆå¯åŠ¨ç¯å¢ƒé…ç½®ï¼‰ | å†³å®š **â€œæ€ä¹ˆè¿è¡Œâ€** |
| **pyth.ts** | å®šä¹‰ï¼šå‘Šè¯‰ç³»ç»Ÿå»å“ªé‡ŒæŸ¥ä»·æ ¼ï¼Œæ¯ç§å–‚ä»·ï¼ˆETH/USDã€wstETH/USD ç­‰ï¼‰å¯¹åº”å“ªä¸ª feedIdã€‚ | ğŸ—ºï¸ **æœåŠ¡å™¨èµ„æºè·¯å¾„ / æ•°æ®é¡µç é“¾æ¥**ï¼ˆAPI endpoint ç´¢å¼•ï¼‰ | å†³å®š **â€œå»å“ªæŸ¥æ•°æ®â€** |
| **selectors.json** | å®šä¹‰ï¼šæ•´ä¸ªé¡¹ç›®æ‰€æœ‰åˆçº¦å‡½æ•°çš„ selector æ˜ å°„è¡¨ã€‚<br>ç”¨äºå®‰å…¨å®¡è®¡ã€æ¨¡ç³Šæµ‹è¯•ã€æ¼æ´éªŒè¯ã€‚<br>é€šå¸¸ç”±å·¥å…·è‡ªåŠ¨ç”Ÿæˆï¼ˆABI â†’ æ‰¹é‡è®¡ç®— selector â†’ è¾“å‡º JSONï¼‰ã€‚ | ğŸ” **æ¥å£è·¯ç”±æ˜ å°„è¡¨ / å®‰å…¨æ‰«æåœ°å›¾** | å†³å®š **â€œèƒ½è°ƒç”¨å“ªäº›å‡½æ•°â€** |
| **test-accounts.ts** | å®šä¹‰ï¼šæµ‹è¯•æˆ–é¢„å‘å¸ƒç½‘ç»œä½¿ç”¨çš„ä¸€æ‰¹å›ºå®šè´¦æˆ·ï¼ˆåœ°å€ + ç§é’¥ï¼‰ã€‚<br>ç”¨äºæ¨¡æ‹Ÿéƒ¨ç½²è€…ã€ç­–ç•¥ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ã€æ²»ç†æŠ•ç¥¨è€…ç­‰èº«ä»½ã€‚ | ğŸ‘¥ **é¢„å‘å¸ƒæµ‹è¯•è´¦å·é…ç½®æ–‡ä»¶**ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·ä¸è§’è‰²ç™»å½•ä¿¡æ¯ï¼‰ | å†³å®š **â€œè°æ¥æ“ä½œâ€** |
| **types.ts** | å®šä¹‰ï¼šå…¨å±€ç±»å‹ä¸ç»“æ„è§„åˆ™ï¼Œæè¿°é¡¹ç›®åœ¨ä¸åŒç½‘ç»œä¸‹çš„éƒ¨ç½²é…ç½®ã€å¸‚åœºç±»å‹ã€é¢„è¨€æœºé…ç½®ã€ç­–ç•¥å®ç°ç­‰ã€‚<br>æ˜¯éƒ¨ç½²ã€æµ‹è¯•å’Œé…ç½®æ–‡ä»¶çš„â€œéª¨æ¶æ ‡å‡†â€ã€‚ | ğŸ“˜ **æœåŠ¡å™¨é…ç½®æ–‡ä»¶çš„æ ¼å¼è§„èŒƒä¹¦**ï¼ˆSchema / Blueprintï¼‰ | å†³å®š **â€œæ‰€æœ‰é…ç½®æ–‡ä»¶è¦é•¿ä»€ä¹ˆæ ·â€** |

---

### ğŸ§± `contracts` ç›®å½•è¯´æ˜ï¼ˆç±»æ¯” Web ä¸–ç•Œï¼‰

åœ¨ Solidity é¡¹ç›®ä¸­ï¼Œ`contracts` ç›®å½•ç›¸å½“äº **Web åç«¯çš„â€œä¸šåŠ¡é€»è¾‘å±‚ + æ§åˆ¶å±‚â€**ã€‚  
è¿™é‡Œçš„æ¯ä¸ªæ–‡ä»¶æˆ–å­ç›®å½•éƒ½å®šä¹‰äº†ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½çš„æ™ºèƒ½åˆçº¦ï¼Œå®ç°èµ„é‡‘æµã€æ²»ç†é€»è¾‘ã€ç­–ç•¥è°ƒç”¨ä¸èµ„äº§ç®¡ç†ã€‚

### ç®€æ˜“ç›®å½•è¯´æ˜
* flashloan é—ªç”µè´·åˆçº¦ç›®å½•
* governance æ²»ç†åˆçº¦ç›®å½•
* hooks é’©å­åˆçº¦ç›®å½•
* router è·¯ç”±åˆçº¦ç›®å½•
* strategies ç­–ç•¥åˆçº¦ç›®å½•
* Constants.sol å¸¸é‡åˆçº¦ï¼Œå®šä¹‰é¡¹ç›®å¸¸é‡ï¼Œå¦‚åœ°å€ã€é€‰æ‹©å™¨ã€å‚æ•°ç­‰ã€‚
* EmptySlot.sol ç©ºæ§½åˆçº¦ï¼Œç”¨äºå¡«å……åˆçº¦å­—èŠ‚ç ï¼Œé¿å…åˆçº¦å­—èŠ‚ç é•¿åº¦å˜åŒ–å¯¼è‡´çš„é—®é¢˜ã€‚
* GovernableOwnable.sol æ²»ç†åˆçº¦ï¼Œå®šä¹‰é¡¹ç›®æ²»ç†æœºåˆ¶ï¼Œå¦‚å‡çº§ã€æš‚åœã€æ¢å¤ç­‰ã€‚
* MultiCommand.sol å¤šå‘½ä»¤åˆçº¦ï¼Œç”¨äºæ‰¹é‡æ‰§è¡Œå¤šä¸ªäº¤æ˜“ã€‚
* MultiStrategy.sol å¤šç­–ç•¥åˆçº¦ï¼Œç”¨äºæ‰¹é‡æ‰§è¡Œå¤šä¸ªç­–ç•¥ã€‚
* MultiStrategyVault.sol å¤šç­–ç•¥åˆçº¦ï¼Œç”¨äºå­˜å‚¨å¤šç­–ç•¥åˆçº¦çš„èµ„äº§ã€‚
* Vault.sol ä¿é™©åº“åˆçº¦
* VaultBase.sol ä¿é™©åº“åˆçº¦åŸºç¡€ç±»ï¼Œå®šä¹‰ä¿é™©åº“åˆçº¦çš„å…¬å…±å‡½æ•°å’ŒçŠ¶æ€å˜é‡ã€‚
* VaultRegistry.sol ä¿é™©åº“åˆçº¦æ³¨å†Œç›®å½•ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ä¿é™©åº“åˆçº¦çš„åœ°å€ã€‚
* VaultRouter.sol ä¿é™©åº“åˆçº¦è·¯ç”±ç›®å½•ï¼Œç”¨äºè·¯ç”±ç”¨æˆ·äº¤æ˜“åˆ°ä¸åŒçš„ä¿é™©åº“åˆçº¦ã€‚
* VaultSettings.sol ä¿é™©åº“åˆçº¦è®¾ç½®ç›®å½•ï¼Œç”¨äºå­˜å‚¨ä¿é™©åº“åˆçº¦çš„è®¾ç½®å‚æ•°ã€‚

### è¯¦ç»†ç›®å½•è¯´æ˜
| æ–‡ä»¶ / ç›®å½• | åŠŸèƒ½è¯´æ˜ | ğŸŒ Web ä¸–ç•Œç±»æ¯” | ä¸€å¥è¯æ€»ç»“ |
|--------------|-----------|----------------|--------------|
| **flashloan/** | é—ªç”µè´·åˆçº¦ç›®å½•ï¼Œå½“å‰å®ç°ä»¥ **BalancerFlashLender.sol** ä¸ºä¸»ï¼Œæä¾›å³æ—¶å€Ÿè´·æ¥å£ï¼›å…¼å®¹ AAVE æ¥å£æ ‡å‡†ï¼ˆä½äº `interfaces/aave/`ï¼‰ã€‚ | âš¡ ä¸´æ—¶èµ„é‡‘æ±  / å³æ—¶äº¤æ˜“å¼•æ“ | å®ç°â€œå€Ÿâ†’ç”¨â†’è¿˜â€åœ¨åŒä¸€äº¤æ˜“å®Œæˆçš„é—ªç”µè´·é€»è¾‘ã€‚ |
| **governance/** | æ²»ç†åˆçº¦ç›®å½•ï¼Œå®šä¹‰é¡¹ç›®çš„å‚æ•°ä¸æƒé™æ²»ç†æœºåˆ¶ã€‚å®é™…åˆçº¦å‡çº§ç”± `proxy/` ä¸‹çš„ `BakerFiProxy` ä¸ `BakerFiProxyAdmin` æ‰§è¡Œã€‚ | ğŸ§­ ç®¡ç†åå°ä¸æƒé™æ§åˆ¶ä¸­å¿ƒ | ç®¡ç†åˆçº¦æƒé™ã€å‚æ•°å’Œæ²»ç†ç»“æ„ã€‚ |
| **hooks/** | é’©å­åˆçº¦ç›®å½•ï¼Œç”¨äºåœ¨ç‰¹å®šæ“ä½œï¼ˆå­˜å–æ¬¾ã€ç­–ç•¥åˆ‡æ¢ç­‰ï¼‰å‰åæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚ | ğŸª ä¸­é—´ä»¶ / äº‹ä»¶é’©å­ç³»ç»Ÿ | è®©ç³»ç»Ÿé€»è¾‘å…·å¤‡æ‰©å±•ä¸å›è°ƒèƒ½åŠ›ã€‚ |
| **router/** | å‘½ä»¤è·¯ç”±ç›®å½•ï¼Œä¸»è¦åŒ…å« `Commands.sol`ï¼ˆå‘½ä»¤æ ‡è¯†åº“ï¼‰ï¼›çœŸæ­£çš„äº¤æ˜“è·¯ç”±åˆçº¦ä½äº `VaultRouter.sol`ã€‚ | ğŸš¦ API ç½‘å…³ / å‘½ä»¤è§£æå±‚ | æä¾›æŒ‡ä»¤è·¯ç”±ä¸ Vault äº¤äº’æ¡¥æ¢ã€‚ |
| **strategies/** | ç­–ç•¥åˆçº¦ç›®å½•ï¼Œå®šä¹‰èµ„äº§å¦‚ä½•è¿ä½œï¼ˆAAVE å€Ÿè´·ã€Curve æä¾›æµåŠ¨æ€§ã€å¥—åˆ©ç­‰ï¼‰ã€‚ | ğŸ§  æŠ•èµ„ç­–ç•¥æ¨¡å— / ä¸šåŠ¡ç®—æ³•å±‚ | è®©èµ„äº§â€œç”Ÿé’±â€çš„æ ¸å¿ƒé€»è¾‘æ‰€åœ¨ã€‚ |
| **Constants.sol** | å®šä¹‰ç³»ç»Ÿçº§å¸¸é‡ï¼ˆå¦‚ `PERCENTAGE_PRECISION`ã€`MAX_LOAN_TO_VALUE`ã€`MAX_LOOPS`ã€`ETH` åŠè§’è‰²å¸¸é‡ `ADMIN_ROLE`ã€`PAUSER_ROLE`ã€`VAULT_MANAGER_ROLE`ï¼‰ã€‚ä¸åŒ…å«å‡½æ•°é€‰æ‹©å™¨ã€‚ | ğŸ§± å…¨å±€å¸¸é‡å®šä¹‰æ–‡ä»¶ | é¡¹ç›®èŒƒå›´å†…å…±äº«çš„é™æ€å‚æ•°ä¸è§’è‰²æ ‡è¯†ã€‚ |
| **EmptySlot.sol** | ä¿ç•™å­˜å‚¨æ§½ä½ï¼Œç¡®ä¿å¯å‡çº§åˆçº¦çš„å­˜å‚¨å¸ƒå±€å…¼å®¹ã€‚ | ğŸ§© ç¼–è¯‘å ä½ / ç‰ˆæœ¬å…¼å®¹æ§åˆ¶ | é¿å…å‡çº§æ—¶å­˜å‚¨ç»“æ„é”™ä¹±ã€‚ |
| **GovernableOwnable.sol** | å®šä¹‰åŒè§’è‰²æ²»ç†æ¨¡å‹ï¼ˆ`owner` ä¸ `governor`ï¼‰ï¼Œæä¾› `onlyGovernor` ä¿®é¥°å™¨ã€‚ | ğŸ” æƒé™ä¸æ²»ç†æ§åˆ¶ | ç®¡ç†ç³»ç»Ÿçš„æ²»ç†è€…ä¸æ‰€æœ‰è€…è§’è‰²ã€‚ |
| **MultiCommand.sol** | æ‰¹é‡æ‰§è¡Œå¤šä¸ªäº¤æ˜“å‘½ä»¤ï¼Œå‡å°‘é“¾ä¸Šäº¤äº’æ¬¡æ•°ä¸ Gas æ¶ˆè€—ã€‚ | ğŸ§° æ‰¹å¤„ç†è„šæœ¬æ‰§è¡Œå™¨ | ä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªæ“ä½œã€‚ |
| **MultiStrategy.sol** | ç®¡ç†å¤šä¸ªç­–ç•¥çš„èšåˆå±‚ï¼Œè´Ÿè´£å°†èµ„äº§æŒ‰æ¯”ä¾‹åˆ†é…è‡³ä¸åŒç­–ç•¥ï¼Œå¹¶æ‰§è¡Œå†å¹³è¡¡ã€‚ | ğŸ¤– ç­–ç•¥è°ƒåº¦ä¸­å¿ƒ | ç»Ÿç­¹å¤šç§æ”¶ç›Šç­–ç•¥çš„è‡ªåŠ¨åˆ†é…ã€‚ |
| **MultiStrategyVault.sol** | å¤šç­–ç•¥èµ„äº§é‡‘åº“ï¼Œé›†ä¸­å­˜å‚¨å’Œç®¡ç†å¤šä¸ªç­–ç•¥çš„èµ„äº§ï¼Œå¹¶è®¡ç®—æ”¶ç›Šåˆ†é…ã€‚ | ğŸ¦ èµ„é‡‘æ‰˜ç®¡ä¸­å¿ƒï¼ˆå¤šç†è´¢äº§å“èµ„äº§æ± ï¼‰ | æ±‡æ€»æ‰€æœ‰ç­–ç•¥èµ„é‡‘çš„æ ¸å¿ƒé‡‘åº“ã€‚ |
| **Vault.sol** | æ ‡å‡†ä¿é™©åº“ï¼ˆVaultï¼‰åˆçº¦ï¼Œå®ç°èµ„äº§å­˜å–ä¸æ”¶ç›Šç»“ç®—é€»è¾‘ã€‚ | ğŸ’° ç”¨æˆ·èµ„äº§è´¦æˆ· / é“¶è¡Œè´¦æˆ·æ ¸å¿ƒé€»è¾‘ | èµ„é‡‘è¿›å‡ºä¸æ”¶ç›Šåˆ†é…çš„æ ¸å¿ƒå…¥å£ã€‚ |
| **VaultBase.sol** | Vault åŸºç±»ï¼Œå°è£…ä¿é™©åº“çš„å…¬å…±å‡½æ•°ä¸çŠ¶æ€å˜é‡ï¼›é€šè¿‡ `AccessControl` ç®¡ç† `PAUSER_ROLE` æ¥å®ç°æš‚åœ/æ¢å¤åŠŸèƒ½ã€‚ | ğŸ§© æŠ½è±¡åŸºç±» / é€šç”¨è´¦æˆ·é€»è¾‘ | Vault ç³»åˆ—çš„é€šç”¨åº•å±‚æ¨¡æ¿ä¸æ§åˆ¶ç‚¹ã€‚ |
| **VaultRegistry.sol** | ä¿é™©åº“æ³¨å†Œè¡¨ï¼Œä¿å­˜ç³»ç»Ÿä¸­æ‰€æœ‰ Vault çš„åœ°å€ä¿¡æ¯ï¼›å¹¶å®šä¹‰å¸¸é‡ï¼ˆå¦‚ `FLASH_LENDER_CONTRACT`ã€`VAULT_ROUTER_CONTRACT`ï¼‰ç”¨äºåœ°å€è§£æã€‚ | ğŸ“‡ æ³¨å†Œä¸­å¿ƒ / æœåŠ¡å‘ç°ç›®å½• | è¿½è¸ªç³»ç»Ÿä¸­æ‰€æœ‰ Vault çš„ç™»è®°ä¸ç´¢å¼•ã€‚ |
| **VaultRouter.sol** | Vault è·¯ç”±åˆçº¦ï¼Œè´Ÿè´£å°†ç”¨æˆ·äº¤æ˜“è¯·æ±‚è·¯ç”±è‡³å¯¹åº”çš„ Vaultã€‚ | ğŸš¦ API ç½‘å…³ / è¯·æ±‚åˆ†å‘å±‚ | è¿æ¥ç”¨æˆ·å…¥å£ä¸é‡‘åº“çš„è°ƒåº¦ä¸­å¿ƒã€‚ |
| **VaultSettings.sol** | ä¿é™©åº“é…ç½®æ¨¡å—ï¼Œå­˜å‚¨ Vault çš„å‚æ•°è®¾å®šï¼Œå¦‚è´¹ç‡ã€é™åˆ¶ã€ç­–ç•¥æ¯”ä¾‹ï¼›å†…éƒ¨æä¾› `_set*` æ–¹æ³•ä¾›å—æ§æ›´æ–°ã€‚ | âš™ï¸ å‚æ•°é…ç½®ä¸­å¿ƒ / è¿è¡Œæ—¶è®¾ç½®æ¨¡å— | åŠ¨æ€è°ƒæ•´é‡‘åº“è¿è¡Œå‚æ•°ã€‚ |

---


ğŸ“˜ **ä¸€å¥è¯æ€»ç»“**

> `contracts/` æ˜¯æ•´ä¸ªç³»ç»Ÿçš„ **æ ¸å¿ƒé€»è¾‘å±‚ï¼ˆCore Logic Layerï¼‰**ï¼š  
> - Vault ç³»åˆ—ï¼š**å­˜é’±ã€ç®—è´¦ã€åˆ†é’±**  
> - Strategy ç³»åˆ—ï¼š**æ‹¿é’±ã€è¿ä½œã€èµšé’±**  
> - Router ç³»åˆ—ï¼š**è¿æ¥å‰ç«¯ä¸é‡‘åº“**  
> - Governance ç³»åˆ—ï¼š**æŒæ§æƒé™ä¸å®‰å…¨**  
> - Flashloan / Hooksï¼š**å¢å¼ºæ‰§è¡Œèƒ½åŠ›ä¸å¯æ‰©å±•æ€§**

---


### ğŸ§± `doc` ç›®å½•è¯´æ˜
* core åŸºæœ¬æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„â€œSolidity APIâ€æ–‡æ¡£ï¼Œä¸æ˜¯äººå·¥é€ç¯‡æ’°å†™ã€‚ç”Ÿæˆæ¥æºæ˜¯ hardhat-docgen / solidity-docgen æ’ä»¶ï¼Œè„šæœ¬ä¸º npm run doc ï¼ˆå³ npx hardhat docgen ï¼‰ã€‚æ–‡æ¡£å†…å®¹æ¥è‡ªåˆçº¦çš„ ABI/AST ä¸ NatSpec æ³¨é‡Šï¼Œéšæºç å˜åŒ–è€Œæ›´æ–°ã€‚
* interfaces æ–‡æ¡£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸æ˜¯äººå·¥ä¸€ç¯‡ç¯‡å†™çš„ã€‚ç”Ÿæˆæ¥æºæ˜¯æ–‡æ¡£ç”Ÿæˆæ’ä»¶ï¼ˆå¦‚ solidity-docgen / hardhat-docgen ï¼‰ï¼Œé¡¹ç›®é‡Œæœ‰ npm run doc æ¥ç”Ÿæˆã€‚é¢å‘æ¥å£çš„â€œSolidity API å‚è€ƒæ‰‹å†Œâ€ï¼ŒæŠŠ contracts/interfaces/* ä¸‹çš„æ¥å£æŒ‰ç›®å½•ç»“æ„å¯¼å‡ºä¸º Markdownã€‚
* libraries è¿™ä¸€æ‰¹ Markdown æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸æ˜¯äººå·¥é€ç¯‡å†™çš„ã€‚é¡¹ç›®ä½¿ç”¨æ–‡æ¡£ç”Ÿæˆæ’ä»¶ï¼ˆ solidity-docgen / hardhat-docgen ï¼‰ï¼Œé€šè¿‡ npm run doc ï¼ˆå³ npx hardhat docgen ï¼‰æŠŠ contracts/libraries/* çš„åº“å¯¼å‡ºä¸ºâ€œSolidity APIâ€å‚è€ƒæ–‡æ¡£ã€‚é¢å‘åº“å‡½æ•°çš„â€œSolidity API å‚è€ƒâ€ï¼Œä¸ºå„ç±»å·¥å…·åº“æä¾›å‡½æ•°ç­¾åã€ struct ã€å¸¸é‡ç­‰çš„ç»Ÿä¸€æ–‡æ¡£ã€‚
* oracles - è¿™æ‰¹ Markdown æ–‡æ¡£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸æ˜¯äººå·¥é€ç¯‡å†™çš„ã€‚ é¡¹ç›®é€šè¿‡æ–‡æ¡£ç”Ÿæˆè„šæœ¬ï¼ˆ npm run doc ï¼Œå³ npx hardhat docgen ï¼‰æŠŠä¸é¢„è¨€æœºç›¸å…³çš„åˆçº¦/æ¥å£å¯¼å‡ºä¸ºâ€œSolidity APIâ€å‚è€ƒæ–‡æ¡£ã€‚é¢å‘â€œé¢„è¨€æœºï¼ˆOracleï¼‰â€çš„ Solidity API å‚è€ƒï¼šåˆ—å‡ºå…¬å¼€å‡½æ•°ç­¾åã€äº‹ä»¶ã€é”™è¯¯ã€å¸¸é‡ã€ struct ç­‰ã€‚- ä¸ºå®¡è®¡ã€å¯¹æ¥ã€è„šæœ¬ç¼–å†™æä¾›ç¦»çº¿æ¥å£æ‰‹å†Œï¼Œå’Œæºç ä¿æŒä¸€ä¸€å¯¹åº”ä¸åŒæ­¥ã€‚
* proxy - è¿™æ‰¹ Markdown æ–‡æ¡£æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸æ˜¯äººå·¥é€ç¯‡å†™çš„ã€‚é¡¹ç›®ä½¿ç”¨æ–‡æ¡£ç”Ÿæˆæ’ä»¶ï¼ˆé€šè¿‡ npm run doc è°ƒç”¨ npx hardhat docgen ï¼‰æŠŠä¸ä»£ç†åˆçº¦ç›¸å…³çš„ä»£ç å¯¼å‡ºä¸ºâ€œSolidity APIâ€å‚è€ƒæ–‡æ¡£ã€‚é¢å‘â€œä»£ç†ï¼ˆProxyï¼‰ä¸å…¶ç®¡ç†åˆçº¦â€çš„ Solidity API å‚è€ƒï¼šåˆ—å‡ºå…¬å¼€å‡½æ•°ç­¾åã€äº‹ä»¶ã€é”™è¯¯ã€å¸¸é‡ã€ struct ç­‰ã€‚
* README.md é¡¹ç›®æ€»è§ˆä¸äº§å“ä»‹ç»ï¼šç›®æ ‡ã€ç­–ç•¥ç†å¿µã€å·²é›†æˆçš„ DeFi ä¹é«˜ã€é£é™©æ§åˆ¶ï¼ˆå¦‚ Liquidation Protectionï¼‰ã€‚ æ¶æ„å›¾ä¸èƒŒæ™¯ææ–™ï¼šå¸®åŠ©è¯»è€…å¿«é€Ÿç†è§£ç³»ç»Ÿè®¾è®¡ä¸æ¨¡å—å…³ç³»ã€‚ ç”¨é€”ï¼šå¯¹å¤–è¯´æ˜ã€å›¢é˜Ÿå†…éƒ¨æ²Ÿé€šã€å®¡è®¡å…¥é—¨èƒŒæ™¯ã€æ–‡æ¡£å¯¼èˆªã€‚
* storage-compatibility.md å­˜å‚¨å¸ƒå±€å…¼å®¹æ€§è®°å½•ï¼šé€ç‰ˆæœ¬åˆ—å‡ºå…³é”®åˆçº¦ï¼ˆå¦‚ Vault ã€ç­–ç•¥åˆçº¦ï¼‰çš„å­˜å‚¨æ§½ä½ï¼ˆslotï¼‰å¯¹åº”å…³ç³»ä¸å˜åŒ–ã€‚ç”¨é€”ï¼šå‡çº§å‰åæ ¸å¯¹ Proxy åˆçº¦çš„å­˜å‚¨å®‰å…¨ï¼Œé¿å…å˜é‡é‡æ’å¯¼è‡´çš„çŠ¶æ€ç ´åï¼›å®¡è®¡ä¸å‘å¸ƒè¯„å®¡çš„é‡è¦ä¾æ®ã€‚

---

### ğŸ§± `scripts` ç›®å½•è¯´æ˜ï¼ˆHardhat è„šæœ¬æ‰§è¡Œä¸åˆçº¦äº¤äº’ä½“ç³»ï¼‰
Hardhat æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€è°ƒè¯•æ™ºèƒ½åˆçº¦çš„ JavaScript/TypeScript æ¡†æ¶ã€‚ å®ƒè®©ä½ å¯ä»¥åœ¨æœ¬åœ°æ¨¡æ‹ŸåŒºå—é“¾ã€ç¼–è¯‘åˆçº¦ã€è¿è¡Œå•å…ƒæµ‹è¯•ã€æ‰§è¡Œéƒ¨ç½²è„šæœ¬ã€è°ƒè¯•äº¤æ˜“ã€ç®¡ç†ä»»åŠ¡ä¸æ’ä»¶ã€‚å®ƒä¸æ˜¯ Hardhat è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè€Œæ˜¯â€œäººç”¨ Hardhat æ¡†æ¶æ‰‹å†™çš„â€ã€‚æ˜¯â€œè¿ç»´ä¸äº¤äº’å±‚â€ï¼ˆéƒ¨ç½²ã€é…ç½®ã€æ“ä½œè¿™äº›åˆçº¦çš„å·¥å…·ï¼‰å®ƒæ˜¯ä¸ºä¸šåŠ¡ä»£ç ï¼ˆæ™ºèƒ½åˆçº¦ï¼‰æä¾›éƒ¨ç½²ã€æ“ä½œã€é…ç½®ã€è°ƒè¯•ã€ç›‘æ§çš„â€œå·¥å…·å±‚â€ã€‚å®ƒæŠŠ Hardhat å½“ä½œå‘½ä»¤æ¡†æ¶ï¼Œç”¨ TypeScript å†™å‡ºâ€œé“¾ä¸Šè¿ç»´ç³»ç»Ÿâ€ã€‚ç±»ä¼¼Linuxçš„shéƒ¨ç½²è„šæœ¬ã€‚


* lib åº•å±‚åº“å±‚ï¼Œæä¾›ç»Ÿä¸€çš„â€œåˆçº¦äº¤äº’å®¢æˆ·ç«¯â€æ¥å£ï¼ˆéƒ¨ç½²ã€äº¤æ˜“ã€è¯»çŠ¶æ€ã€ç­¾åã€å¹¿æ’­ï¼‰
    - ontract-client.ts - å®šä¹‰ç±»å‹ä¸æ¥å£ï¼š TxOptions ï¼ˆäº¤æ˜“é€‰é¡¹ï¼‰ã€ ContractDefinition ï¼ˆABI/bytecodeï¼‰ã€ ContractTreeType ï¼ˆåˆçº¦æ ‘ï¼‰ã€ ContractClient ï¼ˆç»Ÿä¸€å®¢æˆ·ç«¯æ¥å£ï¼‰çº¦å®šäº† deploy ã€ send ã€ call ã€ broadcastTx ã€ init ã€ sign ã€ getAddress ç­‰æ–¹æ³•ç­¾å
    - contract-client-base.ts - æŠ½è±¡åŸºç±» ContractClientBase ï¼Œå®ç°é€šç”¨é€»è¾‘ï¼šdeploy ï¼šç”¨ ethers.ContractFactory æ„é€ éƒ¨ç½²äº¤æ˜“ã€ä¼°ç®— gasã€è®¾ç½®è´¹ç”¨ã€ç­¾åå¹¶å¹¿æ’­ã€‚ send ï¼šç¼–ç å‡½æ•°è°ƒç”¨æ•°æ®ï¼Œä¼°ç®— gasï¼Œç­¾åå¹¶å¹¿æ’­ã€‚call ï¼šåªè¯»è°ƒç”¨ï¼Œè¿”å›é“¾ä¸ŠçŠ¶æ€ã€‚broadcastTx ï¼šå¹¿æ’­å·²ç­¾åäº¤æ˜“å¹¶å¯ç­‰å¾…ç¡®è®¤ã€‚è‡ªåŠ¨æ„å»ºè´¹ç”¨é€‰é¡¹ï¼ˆ maxFeePerGas ã€ maxPriorityFeePerGas ï¼‰ã€‚éœ€å­ç±»å®ç°ï¼š init ã€ getAddress ã€ sign
    - contract-client-wallet.ts - ç§é’¥é’±åŒ…ç‰ˆå®¢æˆ·ç«¯ ContractClientWallet ï¼ˆç»§æ‰¿åŸºç±»ï¼‰ - ä½¿ç”¨ ethers.Wallet è¿›è¡Œæœ¬åœ°ç­¾åï¼Œ init è®¾ç½®åœ°å€ï¼Œ sign è¿”å›å·²ç­¾åäº¤æ˜“ - é€‚åˆè„šæœ¬ç”¨æœ¬åœ°ç§é’¥éƒ¨ç½²/æ“ä½œåˆçº¦
    - contract-client-ledger.ts - Ledger ç¡¬ä»¶é’±åŒ…ç‰ˆå®¢æˆ·ç«¯ ContractClientLedger ï¼ˆç»§æ‰¿åŸºç±»ï¼‰ - ä½¿ç”¨ @ledgerhq/hw-transport-node-hid ä¸ @ledgerhq/hw-app-eth è¿æ¥è®¾å¤‡ã€è·å–åœ°å€ã€ç­¾åäº¤æ˜“ï¼ˆå« ledgerService.resolveTransaction è§£æï¼‰ - é€‚åˆåœ¨ç”Ÿäº§æˆ–æ›´å®‰å…¨åœºæ™¯ç”¨ç¡¬ä»¶ç­¾åï¼›Windows éœ€ HID æ”¯æŒä¸è®¾å¤‡é©±åŠ¨

* tasks  ä»»åŠ¡å±‚ï¼ŒåŸºäº Hardhat çš„å‘½ä»¤ç³»ç»Ÿï¼ŒæŠŠåº•å±‚æ¥å£å°è£…æˆå…·ä½“æ“ä½œä»»åŠ¡ï¼ˆéƒ¨ç½² Vaultã€æ›´æ–°å‚æ•°ã€æŸ¥è¯¢èµ„äº§ç­‰ï¼‰ã€‚
    - index.ts - æ±‡æ€»æ³¨å†Œæ‰€æœ‰å­ä»»åŠ¡ï¼š build ã€ deploy ã€ oracles ã€ settings ã€ strategy ã€ token ã€ vault ã€ router - æä¾›ç»„åˆå‘½ä»¤ï¼š - vault:resume ï¼šä¸²è¡Œè°ƒç”¨å¤šé¡¹æŸ¥è¯¢ï¼Œè¾“å‡º Vault/Strategy é…ç½®æ¦‚è§ˆ - bakerfi:loop ï¼šåœ¨ Base ç½‘ç»œå¾ªç¯æ‰§è¡Œå­˜å–ï¼Œç”¨äºå‹åŠ›æˆ–æµç¨‹æµ‹è¯•ï¼ˆä¾èµ– ANKR_API_KEY ã€ TEST_LOOP_KEY ï¼‰
    - vault.ts Vault æ“ä½œä¸æŸ¥è¯¢ï¼š - vault:balance ï¼šæŸ¥è¯¢è´¦æˆ· brETH ä»½é¢ - vault:assets ï¼šæŸ¥è¯¢ Vault æ€»èµ„äº§ - vault:tokenPerAsset ï¼šæŸ¥è¯¢ tokenPerAsset - vault:rebalance ï¼šè§¦å‘å†å¹³è¡¡ - vault:deposit ï¼š depositNative å­˜å…¥ ETH - vault:withdraw ï¼š withdrawNative ç”¨ brETH å–å› ETH
    - settings.ts è´¹ç”¨ä¸æƒé™é…ç½®ã€ç­–ç•¥ä»·æ ¼å‚æ•°ï¼š - è´¦æˆ·ç™½åå•ï¼š vault:enableAccount ã€ vault:isAccountEnabled - è´¹ç”¨ç›¸å…³ï¼š vault:getFeeReceiver ã€ vault:setFeeReceiver ã€ vault:getWithdrawalFee ã€ vault:setWithdrawalFee ã€ vault:getPerformanceFee ã€ vault:setPerformanceFee - å­˜æ¬¾ä¸Šé™ï¼š settings:setMaxDeposit ã€ settings:getMaxDeposit - ä»·æ ¼å‚æ•°ï¼š strategy:setPriceMaxAge ã€ strategy:getPriceMaxAge ã€ strategy:setRebalancePriceMaxAge ã€ strategy:setPriceMaxConfidence ã€ strategy:getPriceMaxConfidence
    - strategy.ts ç­–ç•¥å‚æ•°ä¸ä½ç½®ä¿¡æ¯ï¼š - å›è·¯è®¾ç½®ï¼š strategy:setNrLoops ã€ strategy:getNrLoops - æ»‘ç‚¹ä¸ LTVï¼š strategy:setMaxSlippage ã€ strategy:getMaxSlippage ã€ strategy:getMaxLoanToValue ã€ strategy:setMaxLoanToValue ã€ strategy:getLoanToValue ã€ strategy:setLoanToValue - å¤´å¯¸ä¿¡æ¯ï¼š strategy:getPosition ã€ strategy:position ï¼ˆç»“åˆ AAVE æ± æ•°æ®ï¼‰
    - oracles.ts - é¢„è¨€æœºæ•°æ®ä¸å¯¹æ¯”ï¼š - Pyth æ›´æ–°ï¼š oracles:priceUpdate ï¼ˆæ‹‰å– Hermes ç­¾åä»·æ ¼ã€è®¡ç®—è´¹ç”¨å¹¶é“¾ä¸Šæ›´æ–°ï¼‰ - å•ä»·æŸ¥è¯¢ï¼š oracles:getETHPrice ã€ oracles:getWSTETHPrice - æ‰¹é‡ä¸æ¯”å¯¹ï¼š oracles:prices ã€ oracles:compare
    - router.ts - Router æ‰¹å¤„ç†å‘½ä»¤ï¼š - router:deposit ï¼šé€šè¿‡ VaultRouter æ„é€ å‘½ä»¤æ•°ç»„å®ç° ETH åŒ…è£…ã€ERC4626 å……å€¼ç­‰æ‰¹æ“ä½œ - router:withdraw ï¼šERC4626 å–å‡ºã€è§£åŒ… ETHã€å‘é€åˆ°ç”¨æˆ·åœ°å€
    - build.ts - æ„å»ºè¾…åŠ©ï¼š - build:artifactTree ï¼šç¼–è¯‘åæ‰«æ artifacts ï¼Œç”Ÿæˆ src/contract-blob.json ï¼ˆåŒ…å« ABI/bytecodeï¼‰ - build:calculateSelectors ï¼šåŸºäº contract-blob.json è®¡ç®—æ‰€æœ‰å‡½æ•°/é”™è¯¯é€‰æ‹©å™¨ï¼Œè¾“å‡ºåˆ° src/contract-selectors.json
    - deploy.ts - éƒ¨ç½²ä¸å‡çº§ï¼š - deploy:oracle:wstEthToUsdRatio ï¼šéƒ¨ç½² ChainLink æ¯”ä»· Oracle å¹¶è®¾ç½®åˆ°ç­–ç•¥ - deploy:upgrade:strategy ï¼šéƒ¨ç½²æ–°ç­–ç•¥å®ç°å¹¶é€šè¿‡ ProxyAdmin.upgrade å‡çº§ - deploy:upgrade:vault ï¼šéƒ¨ç½²æ–° Vault å®ç°å¹¶å‡çº§
    - token.ts - åŸºç¡€æŸ¥è¯¢ï¼š - balance ï¼šæŸ¥è¯¢ä»»æ„åœ°å€ ETH ä½™é¢





## æ¦‚å¿µè¯å…¸
* è¯­è¨€æœºï¼Œæ™ºèƒ½åˆçº¦ç³»ç»Ÿä¸ç°å®ä¸–ç•Œä¹‹é—´çš„æ¡¥æ¢ï¼Œæœ¬è´¨ä¸Šæ˜¯å¤šä¸ªèŠ‚ç‚¹æŠ•ç¥¨å…±è¯†çš„æ•°æ®è¿”å›æ¥å£API
* å–‚ä»·ï¼ˆfeedingï¼‰ï¼ŒæŠŠæ•°æ®é€åˆ°é“¾ä¸Šï¼Œæä¾›æ•°æ®ã€‚
* ç”¨ä»·ï¼ˆconsumingï¼‰ï¼Œæ™ºèƒ½åˆçº¦è¯»å–è¿™äº›æ•°æ®ï¼Œä½¿ç”¨æ•°æ®ã€‚
* ä¿é™©åº“ï¼ˆvault ï¼‰ï¼Œè´Ÿè´£å­˜å‚¨å’Œç®¡ç†èµ„äº§çš„æ™ºèƒ½åˆçº¦ï¼Œæ¥å—å­˜å…¥ä»£å¸ï¼Œç„¶åæŠŠèµ„é‡‘äº¤ç»™åº•å±‚ç­–ç•¥å–è¿ä½œï¼ˆæ”¾è´·ã€æŒ–çŸ¿ã€è´¨æŠ¼ã€å¥—åˆ©ï¼‰ï¼Œæœ€åæŠŠæ”¶ç›ŠæŒ‰ç…§æ¯”ä¾‹åˆ†ç»™ç”¨æˆ·ã€‚